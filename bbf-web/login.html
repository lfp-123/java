<!DOCTYPE html>
<html>
<meta name="referrer" content="no-referrer">
<head lang="en">
  <meta charset="UTF-8">
  <title>BOSS统一资产管理平台</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="format-detection" content="telephone=no">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <script src="skeleton/includeJs_3rd.js"></script>
  <script src="skeleton/includeCss_3rd.js"></script>
  <style>
	.topPanel {
		width: inherit;
		height: 25%;
		position: relative;
		background-color: red;
	}
	.centerPanel {
		width: inherit;
		height: 60%;
		padding: 50px 20px 20px 20px;
	}
	.bottomPanel {
		width: inherit;
		height: 15%;
	}
	.leftPanel {
		height: 100%;
		margin-right: 512px;
	}
	.rightPanel {
		width: 512px;
		height: 100%;
		float: right;
		background-color: red;
	}
	.username{
            position: relative;
        }
     .username::before{
         content: url(skeleton/images/user-icon.png);
         float: left;
         font-size: 25px;
         position: absolute;
         line-height: 40px;
         left: 28px;
     }
     .username input{
         display: block;
         padding-left: 50px;
         height: 40px;
         box-sizing: border-box;
         background: none;
         border: none;
         border-bottom: 1px solid #aaaaaa;
         width: 430px;
         margin-left: 20px;
         font-size: 16px;
     }
     
     .password{
            position: relative;
        }
     .password::before{
         content: url(skeleton/images/pass-icon.png);
         float: left;
         font-size: 25px;
         position: absolute;
         line-height: 40px;
         left: 28px;
     }
     .password input{
         display: block;
         padding-left: 50px;
         height: 40px;
         box-sizing: border-box;
         background: none;
         border: none;
         border-bottom: 1px solid #aaaaaa;
         width: 430px;
         margin-left: 20px;
         font-size: 16px;
     }
     
     .verify{
            position: relative;
        }
     .verify::before{
         content: url(skeleton/images/veri-icon.png);
         float: left;
         font-size: 25px;
         position: absolute;
         line-height: 40px;
         left: 28px;
     }
     .verify input{
         display: block;
         padding-left: 50px;
         height: 40px;
         box-sizing: border-box;
         background: none;
         border: none;
         border-bottom: 1px solid #aaaaaa;
         width: 430px;
         margin-left: 20px;
         font-size: 16px;
     }
     input:-webkit-autofill {
        -webkit-box-shadow: 0 0 0 1000px white inset;
    }
    
    .warnIcon{
            color: #f75d68;
            text-align: center;
            padding-top: 41px;
        }
     .verify-img{
     	font-size: 25px;
        position: absolute;
        right: 28px;
        top: 0px;
        cursor: pointer;
     }
     
     .loginBtn:hover,
     .loginBtn:focus,
     .loginBtn:active {  
	      filter:alpha(opacity=80);  
	      -moz-opacity:0.8;  
	      -khtml-opacity: 0.8;  
	      opacity: 0.8;  
	 }
	 
	.experience {
		position:fixed;
		height:30px;
		line-height:30px;
		background:url(skeleton/images/experience.png) repeat;
		color:#fff;
		width:995px;
		text-align: center;
		z-index:6000;
		animation:tada 1s 1s;
		left: 0;
		right: 0;
		bottom:0;
		margin:0 auto;
	}
	.experience .em-close {
		background:url(skeleton/images/close.png) no-repeat;
		width:30px;
		height:30px;
		position:absolute;
		cursor:pointer;
		right:0;
		top:0;
		opacity:.8;
	}
	
	.experience .em-close:hover {
		opacity:1;
	}
	
	.experience a {
		text-decoration: underline;
		color: #00ff00;
		opacity:.8;
	}
	.experience a:hover {
		opacity:1;
	}
	
	@keyframes tada{
	from{transform:scale3d(1, 1, 1)}
	10%, 20%{transform:scale3d(.9, .9, .9) rotate3d(0, 0, 1, -3deg)}
    30%, 50%, 70%, 90%{transform:scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, 3deg)}
    40%, 60%, 80%{transform:scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, -3deg)}
    to{transform:scale3d(1, 1, 1)}
    }
     
  </style>
</head>
<body ng-app="loginApp" ng-controller="loginController">
	<div class="tc experience">为了获得更好的用户体验，请使用<a href="javascript:" title="下载火狐浏览器" ng-click="downloadFirefox()"
	>火狐</a>、<a href="javascript:" title="下载谷歌浏览器" ng-click="downloadGoogle()">谷歌</a>、360浏览器极速模式或<a href="javascript:" title="下载IE11浏览器" ng-click="downloadIE11()"
	>IE11</a>及以上版本的浏览器。<em class="em-close"></em></div>
	<div style="width: 512px; float: right; height: 100%;">
		<div style="vertical-align: bottom; height: 25%; position: relative;">
			<img alt="" src="skeleton/images/1590029226_838479.png" style="position: absolute; bottom: 0px; left: 90px;">
		</div>
		<div class="centerPanel">
			<!--<ul id="loinTab"  class="nav nav-tabs">-->
				<!--&lt;!&ndash;<li class="active"><a href="#notes" data-toggle="tab" ng-click="clear(1)">notes用户登录</a></li>&ndash;&gt;-->
				<!--&lt;!&ndash;<li><a href="#login" data-toggle="tab" ng-click="clear(0)">账户登录</a></li>&ndash;&gt;-->
			<!--</ul>-->
			<div id="loginTabContent" class="tab-content">
				<form action="login" method="post" name="loginForm">
					<input type="hidden" id="_csrf" name="_csrf" ng-value="csrf_token"/>
					<!--<input type="hidden" id="loginType" name="loginType" ng-value="loginType"/>-->
					<div class="username" style="margin-top: 38px;">
				        <input type="text" placeholder="请输入账号" name="username" id="username" ng-model="username" autocomplete="off"/>
				    </div>
				    <div class="password" style="margin-top: 38px;">
				    	<input type="password" style="display: none;"/>
				        <input type="text" placeholder="请输入密码" name="password" id="password" ng-model="password" maxlength="20" autocomplete="off" onfocus="this.type='password'"/>
				    </div>
				    <div class="verify" style="margin-top: 38px;">
				        <input type="text" placeholder="请输入验证码" name="verifyCode" id="verifyCode" ng-model="verifyCode" maxlength="4" />
				        <img id="randCodeImage" src="rest/VerificationCodeGenerate" class="verify-img" ng-click="changeVerificationCode()">
				    </div>
				    <div style="position: relative;">
				    	<div class="warnIcon" ng-show="verifyStatus" ng-cloak><img src="skeleton/images/warn-icon.png" style="margin-bottom: 3px; margin-right: 4px;">{{verifyMessage}}</div>
				    	<img class="loginBtn" src="skeleton/images/login-btn.png" style="top: 68px; left: 30px; position: absolute; cursor: pointer;" ng-click="login()">
				    	<span style="position:absolute; z-index:2;left:210px;top:82px;font-size: 16px; color: #fff; cursor: pointer;" ng-click="login()">登&nbsp;&nbsp;&nbsp;&nbsp;录</span>
				    </div>
				</form>
			</div>
		</div>
		<div class="bottomPanel">
		</div>
	</div>
	<div style="height: 100%; margin-right: 512px;">
		<img style="width: 100%;" src="skeleton/images/20200521103922.png">
		<!--<img src="skeleton/images/logo.png" style="position: absolute; top: 30px; left: 30px;">-->
	</div>
	<script type="text/javascript">
	window.load = function(){ 
		document.getElementById('username').value=''; 
		document.getElementById('password').value=''; 
	}; 
	var loginApp = angular.module('loginApp', ['ui.bootstrap']);
	loginApp.controller('loginController', function($scope, $http) {
		$scope.username = '';
		$scope.password = '';
		document.onkeydown = function(e){
		   if(!e){
		       e = window.event;
		   }
		   if((e.keyCode || e.which) == 13){
			   $scope.login(); 
		   }
		};
		
		$scope.changeVerificationCode = function(){       
		    var randCodeImg = $("#randCodeImage");       
		    var src = randCodeImg.attr("src");       
		    randCodeImg.attr("src",changeUrl(src));       
		}
		
		function changeUrl(url){       
		    var timestamp = (new Date()).valueOf();       
		    if((url.indexOf("&")>=0)){       
		    	url = url + "timestamp=" + timestamp;       
		    }else{       
		    	url = url + "?timestamp=" + timestamp;       
		    }       
		    return url;       
		}
		
		$scope.loginType = 1;
		$scope.clear = function(type) {
			$scope.loginType = type;
			$scope.verifyStatus = 0;
		}
		
		$scope.login = function(){
			if ($scope.username == '' || $scope.username == undefined) {
				$scope.verifyStatus = -1;
				$scope.verifyMessage = "请输入账号！";
				document.getElementById("username").value = '';
				return;
			} else {
				if($scope.loginType == 0) {
					if ($scope.username.length > 8) {
						$scope.verifyStatus = -1;
						$scope.verifyMessage = "账号只支持8位！";
						return;
					}
					if (!/^\-?\d*$/.test($scope.username) || $scope.username < 0) {
						$scope.verifyStatus = -1;
						$scope.verifyMessage = "账号必须是纯数字！";
						return;
					}
				}
				$scope.verifyStatus = 0;
			}
			if ($scope.password == '' || $scope.password == undefined) {
				$scope.verifyStatus = -1;
				$scope.verifyMessage = "请输入密码！";
				document.getElementById("password").value = '';
				return;
			} else {
				$scope.verifyStatus = 0;
			}
			if ($scope.verifyCode == '' || $scope.verifyCode == undefined) {
				$scope.verifyStatus = -1;
				$scope.verifyMessage = "请输入验证码！";
				document.getElementById("verifyCode").value = '';
				return;
			} else {
				$scope.verifyStatus = 0;
			}
		//	if($scope.loginType == 0) {
				//普通登录
				$http({
					method : 'POST',
					url: 'rest/verifyUsernameAndPassword',
					data: $scope.username + '|' + $.md5($scope.password) + '|' + $scope.verifyCode
				}).then(function successCallback(response) {
					$scope.verifyStatus = parseInt(response.data.verifyStatus);
					$scope.verifyMessage = response.data.verifyMessage;
					localStorage.setItem("loginType", $scope.loginType);
					localStorage.setItem("modifyOpeId", $scope.username);
					localStorage.setItem("operatorLevel", response.data.operatorLevel);
					if ($scope.verifyStatus == 0) {
						$http({
							method : 'GET',
							url: 'home/csrf.jsp',
							headers : {
								"Content-Type" : "application/json"
							}
						}).then(function successCallback(response) {
							$scope.csrf_parameterName=response.data.csrf_parameterName;
							$scope.csrf_token=response.data.csrf_token;
							document.getElementById("_csrf").value = response.data.csrf_token;
							document.forms['loginForm'].submit();
						}, function errorCallback(response) {
							console.log(response);
							window.location = "accessdenied.html";
						});
					} else if ($scope.verifyStatus == '1004') {
						$scope.changeVerificationCode();
					}
				}, function errorCallback(response) {
					 console.log(response);
					 window.location = "accessdenied.html";
				});
		//	}
			//else if($scope.loginType == 1) {
//				//notes用户登录
//				$http({
//					method : 'POST',
//					url: 'rest/verifyNotesUser',
//					data: $scope.username + '|' + $scope.password + '|' + $scope.verifyCode
//				}).then(function successCallback(response) {
//					$scope.verifyStatus = parseInt(response.data.verifyStatus);
//					$scope.verifyMessage = response.data.verifyMessage;
//					localStorage.setItem("loginType", $scope.loginType);
//					localStorage.setItem("modifyOpeId", response.data.operatorId);
//					localStorage.setItem("operatorLevel", response.data.operatorLevel);
//					if ($scope.verifyStatus == 0) {
//						$http({
//							method : 'GET',
//							url: 'home/csrf.jsp',
//							headers : {
//								"Content-Type" : "application/json"
//							}
//						}).then(function successCallback(response) {
//							$scope.csrf_parameterName=response.data.csrf_parameterName;
//							$scope.csrf_token=response.data.csrf_token;
//							document.getElementById("_csrf").value = response.data.csrf_token;
//							document.forms['loginForm'].submit();
//						}, function errorCallback(response) {
//							console.log(response);
//							window.location = "accessdenied.html";
//						});
//					} else if ($scope.verifyStatus == '1004') {
//						$scope.changeVerificationCode();
//					}
//				}, function errorCallback(response) {
//					 console.log(response);
//					 window.location = "accessdenied.html";
//				});
//			}
			
		};
		
		if (window.name != "loginPage") {
			location.reload();
			window.name = "loginPage";
		} else {
			window.name = "";
		}
		
		$(".experience .em-close").click(function(){
			$(this).parent().hide();
		});
		
		//下载火狐浏览器
		$scope.downloadFirefox = function() {
			var fileDir = "/skeleton/explorers/Firefox-ESR-full-latest.exe";
			downloadBtn(fileDir);
		};
		//下载谷歌浏览器
		$scope.downloadGoogle = function() {
			var fileDir = "/skeleton/explorers/67.0.3396.99_chrome_installer.exe";
			downloadBtn(fileDir);
		}
		
		//下载IE11浏览器
		$scope.downloadIE11 = function() {
			var agent = navigator.userAgent.toLowerCase();
			var fileDir = "/skeleton/explorers/IE11-Setup-Full-32bitieak.exe";
		    if (agent.indexOf("win64") >= 0 || agent.indexOf("wow64") >= 0) {
		    	fileDir = "/skeleton/explorers/IE11-Windows6.1-x64-zh-cn.exe";
		    }
			downloadBtn(fileDir);
		}
		
		downloadBtn = function(fileDir) {
			var myForm = document.createElement("form");
			myForm.action = "rest/downloadBatchResult";
			myForm.method = "POST";
			myForm.style.display = "none";
			//下载路径
			var opt = document.createElement("input");
			opt.type = "text";
			opt.id = "fileDir";
			opt.name = "fileDir";
			opt.value = fileDir;
			
			myForm.appendChild(opt);
			document.body.appendChild(myForm);
			myForm.submit();
			document.body.removeChild(myForm);
		};
		
	});
	</script>
</body>
</html>